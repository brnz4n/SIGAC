<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGAC - Lançamento Manual</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="imagens/favicon sigac ofc.png">
    
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow-sm py-2 anime-start">
        <div class="container-fluid px-5">
            <a class="navbar-brand d-flex align-items-center gap-2" href="dashboard_coordenador.html">
                <img src="imagens/favicon sigac ofc.png" alt="Logo" height="60" style="filter: brightness(0) invert(1);">
                <span class="fw-bold small d-none d-md-block">COORDENAÇÃO</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuCoord">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="menuCoord">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-4 gap-2">
                    <li class="nav-item">
                        <a class="nav-link text-white-50" href="dashboard_coordenador.html"><i class='bx bxs-dashboard'></i> Visão Geral</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active fw-bold" href="#"><i class='bx bxs-edit'></i> Lançamento Manual</a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center gap-3 text-white">
                    <div class="text-end d-none d-lg-block">
                        <p class="mb-0 small fw-bold" id="nomeCoordenador">Prof. Fernando</p>
                        <p class="mb-0 small opacity-75" style="font-size: 0.75rem;">Coordenador</p>
                    </div>
                    <button onclick="logout()" class="btn btn-outline-light btn-sm rounded-pill px-3">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5 pb-5">
        
        <div class="row pt-4 mb-4 align-items-center anime-start" style="transition-delay: 0.1s;">
            <div class="col-auto">
                <a href="dashboard_coordenador.html" class="btn btn-outline-secondary rounded-circle" title="Voltar">
                    <i class='bx bx-arrow-back'></i>
                </a>
            </div>
            <div class="col">
                <h3 class="fw-bold text-dark mb-0">Lançamento Administrativo</h3>
                <p class="text-muted mb-0">Adicionar horas complementares diretamente ao histórico do aluno.</p>
            </div>
        </div>

        <form onsubmit="lancamentoManual(event)">
            <div class="row anime-start" style="transition-delay: 0.2s;">
                
                <!-- COLUNA ESQUERDA -->
                <div class="col-lg-8">
                    
                    <!-- Passo 1: Buscar Aluno -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white py-3 border-bottom">
                            <h5 class="mb-0 fw-bold text-primary"><i class='bx bx-user-pin'></i> 1. Identificação do Discente</h5>
                        </div>
                        <div class="card-body p-4">
                            <label class="form-label small fw-bold text-muted">Buscar Aluno (Digite o nome ou matrícula)</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text bg-white border-end-0 text-primary"><i class='bx bx-search'></i></span>
                                <!-- Input conectado ao Datalist -->
                                <input type="text" class="form-control border-start-0 ps-0" id="buscaAluno" placeholder="Ex: Maria..." list="alunosList" required>
                                <datalist id="alunosList">
                                    <!-- Options serão preenchidas via JS -->
                                </datalist>
                                <button class="btn btn-primary px-4" type="button" onclick="buscarAlunoDetalhes()">Verificar</button>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 2: Dados da Atividade -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white py-3 border-bottom">
                            <h5 class="mb-0 fw-bold text-primary"><i class='bx bx-layer'></i> 2. Detalhes da Atividade</h5>
                        </div>
                        <div class="card-body p-4">
                            
                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-muted">Grupo <span class="text-danger">*</span></label>
                                    <select class="form-select" id="grupoAtividade" onchange="atualizarTipos()" required>
                                        <option selected disabled value="">Selecione...</option>
                                        <option value="ENSINO">Grupo I - Ensino</option>
                                        <option value="PESQUISA">Grupo II - Pesquisa</option>
                                        <option value="EXTENSAO">Grupo III - Extensão</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-muted">Tipo <span class="text-danger">*</span></label>
                                    <select class="form-select" id="tipoAtividade" onchange="atualizarSubtipos()" required disabled>
                                        <option selected disabled value="">Selecione o Grupo</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-muted">Subtipo <span class="text-danger">*</span></label>
                                    <!-- No backend real, esse ID deve bater com o ID do subtipo no banco (1, 2, 3...) -->
                                    <!-- Aqui usaremos valores fictícios para mapear no JS se necessário -->
                                    <select class="form-select" id="subtipoAtividade" required disabled>
                                        <option selected disabled value="">--</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted">Descrição da Atividade <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="descricaoAtividade" placeholder="Ex: Participação na Semana de Tecnologia 2024" required>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Instituição Promotora</label>
                                    <!-- Em um cenário real, deveria ser um select de instituições cadastradas -->
                                    <input type="text" class="form-control" id="nomeInstituicao" placeholder="Ex: UFC Sobral" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small fw-bold text-muted">Data Início</label>
                                    <input type="date" class="form-control" id="dataInicio" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label small fw-bold text-muted">Data Fim</label>
                                    <input type="date" class="form-control" id="dataFim" required>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- COLUNA DIREITA -->
                <div class="col-lg-4">
                    
                    <!-- Passo 3: Carga Horária -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white py-3 border-bottom">
                            <h5 class="mb-0 fw-bold text-primary"><i class='bx bx-time'></i> 3. Cômputo de Horas</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="alert alert-warning small d-flex gap-2">
                                <i class='bx bx-info-circle fs-4'></i>
                                <div>
                                    <strong>Atenção:</strong> Lançamentos manuais são creditados imediatamente.
                                </div>
                            </div>

                            <label class="form-label small fw-bold text-muted">Quantidade de Horas <span class="text-danger">*</span></label>
                            <div class="input-group input-group-lg mb-3">
                                <input type="number" class="form-control fw-bold text-primary" id="cargaHoraria" placeholder="0" required min="1">
                                <span class="input-group-text bg-light">horas</span>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 4: Auditoria -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white py-3 border-bottom">
                            <h5 class="mb-0 fw-bold text-primary"><i class='bx bx-shield-quarter'></i> 4. Auditoria</h5>
                        </div>
                        <div class="card-body p-4">
                            <label class="form-label small fw-bold text-muted">Motivo do Lançamento <span class="text-danger">*</span></label>
                            <textarea class="form-control mb-3" id="justificativa" rows="3" placeholder="Ex: Correção de histórico / Atividade antiga..." required></textarea>
                            
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="confirmaVeracidade" required>
                                <label class="form-check-label small text-muted" for="confirmaVeracidade">
                                    Declaro que verifiquei os documentos e assumo a responsabilidade.
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Botões -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success rounded-pill py-3 fw-bold shadow-sm hover-scale">
                            <i class='bx bx-save'></i> EFETIVAR LANÇAMENTO
                        </button>
                        <a href="dashboard_coordenador.html" class="btn btn-outline-secondary rounded-pill py-2 border-0">
                            Cancelar
                        </a>
                    </div>

                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="api.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            setTimeout(() => document.querySelectorAll('.anime-start').forEach(el => el.classList.add('anime-end')), 100);
            
            // Carregar lista de alunos para o Datalist
            if(typeof carregarListaAlunos === 'function') {
                carregarListaAlunos();
            }
        });

        // Reaproveitando a lógica de selects (Mesma do cadastro do aluno)
        function atualizarTipos() {
            const grupo = document.getElementById('grupoAtividade').value;
            const tipoSelect = document.getElementById('tipoAtividade');
            const subtipoSelect = document.getElementById('subtipoAtividade');
            
            tipoSelect.innerHTML = '<option value="" selected disabled>Selecione...</option>';
            subtipoSelect.innerHTML = '<option value="" selected disabled>--</option>';
            subtipoSelect.disabled = true;
            tipoSelect.disabled = false;

            if (grupo === 'ENSINO') {
                tipoSelect.innerHTML += `<option value="MONITORIA">Monitoria</option>`;
            } else if (grupo === 'PESQUISA') {
                tipoSelect.innerHTML += `<option value="INICIACAO_CIENTIFICA">Iniciação Científica</option>`;
            } else if (grupo === 'EXTENSAO') {
                tipoSelect.innerHTML += `<option value="EVENTO">Evento</option>`;
            }
        }

        function atualizarSubtipos() {
            const subtipoSelect = document.getElementById('subtipoAtividade');
            subtipoSelect.innerHTML = '<option value="" selected disabled>Selecione...</option>';
            subtipoSelect.disabled = false;
            // Para simplificar, vou adicionar valores genéricos que seriam IDs no banco
            subtipoSelect.innerHTML += `<option value="1">Geral</option><option value="2">Voluntário</option>`;
        }
    </script>
</body>
</html>